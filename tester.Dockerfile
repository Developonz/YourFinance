# ==================================================================
# Dockerfile для ТЕСТИРУЮЩЕГО контейнера (tester)
# Задача: запуск эмулятора Android и прогон инструментальных тестов.
# ==================================================================

# Шаг 1: Наследуем от нашего сборочного образа 'my-android-builder'.
# Это дает нам уже настроенные Java, Android SDK и переменные окружения.
FROM my-android-builder:latest


# Шаг 2: Устанавливаем компоненты SDK, необходимые для эмуляции.
# 'emulator' - сам движок эмулятора.
# 'system-images;android-34;google_apis;x86_64' - образ ОС Android API 34 
# с сервисами Google для 64-битной архитектуры x86.
# Важно: версия API (android-34) должна соответствовать той, что используется в builder'е.
RUN sdkmanager "emulator" "system-images;android-34;google_apis;x86_64"

# Шаг 3: Заранее создаем виртуальное устройство (AVD).
# Это значительно ускоряет этап запуска тестов в Jenkins, так как эмулятор
# не нужно будет создавать каждый раз с нуля.
# Имя 'Medium_Phone_API_34' выбрано для соответствия твоему проекту.
# 'echo "no"' автоматически отвечает 'нет' на вопрос о создании кастомного профиля устройства.
RUN echo "no" | avdmanager create avd \
    --name "Medium_Phone_API_34" \
    --package "system-images;android-34;google_apis;x86_64" \
    --device "pixel_6" \
    --force

# Шаг 4: Рабочая директория уже унаследована от базового образа,
# поэтому ее определять заново не нужно.
# WORKDIR /app